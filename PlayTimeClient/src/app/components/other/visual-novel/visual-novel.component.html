<div class="body" *ngIf="!intro && !editing">
    <header *ngIf="false">
        <p>optional</p>
    </header>
    <div class="screen" [ngStyle]="scene.styling">
        <div class="save icon" style="display: flex; flex-direction: row-reverse; justify-content: space-between; ">
            <img src="../../../../assets/icons/saveButton.png" alt="Save Button"
                style="cursor: pointer; user-select:none;" title="Save Button" (click)="emitSavingEvent()"
                *ngIf="showSaveIcon" class="image">
            <img src="../../../../assets/icons/exitButton.png" alt="Close Button"
                style="cursor: pointer; user-select:none;" title="Exit Button" (click)="emitExitEvent()"
                *ngIf="showExitButton" class="image">
        </div>
        <div class="textbox" [ngStyle]="getStyling('prompt')">
            {{getText()}}
        </div>
    </div>
    <div class="optionBar" *ngIf="showChoices()">
        <div class="option" *ngFor="let option of getAllChoices()" (click)="clickChoice(option)"
            [ngStyle]="getStyling(option)">
            <p>{{option.text}}</p>
        </div>
    </div>
    <div class="optionBar" *ngIf="!showChoices()">
        <div class="option" (click)="clickChoice()" [ngStyle]="getStyling()">
            <p>{{getTextForTextBox()}}</p>
        </div>
    </div>
</div>
<div *ngIf="intro && !editing" class="body">
    <app-glitch-text [text]="'Powered by'" [locationStyling]="{'margin-top': '20%'}"
        [href]="'https://github.com/oldmartijntje/Angular-components'"
        [textStyling]="{'font-size': '2rem', 'cursor': 'pointer'}"></app-glitch-text>
    <app-glitch-text [text]="'OldMartijntje'" [locationStyling]="{'margin-top': '7%'}"
        [textStyling]="{'cursor': 'pointer'}"
        [href]="'https://github.com/oldmartijntje/Angular-components'"></app-glitch-text>
    <app-glitch-text [text]="'You can use this for free.'" [locationStyling]="{'margin-top': '10%'}"
        [textStyling]="{'font-size': '2rem', 'cursor': 'pointer'}"
        [href]="'https://github.com/oldmartijntje/Angular-components'"></app-glitch-text>
</div>
<div class="body scroll" *ngIf="editing">
    <div class="save icon" style="display: flex; flex-direction: row-reverse; justify-content: space-between; ">
        <img src="../../../../assets/icons/saveButton.png" alt="Save Button" style="cursor: pointer; user-select:none;"
            title="Save Button" (click)="emitSavingEvent()" *ngIf="showSaveIcon" class="image">
        <img src="../../../../assets/icons/exitButton.png" alt="Close Button" style="cursor: pointer; user-select:none;"
            title="Exit Button" (click)="emitExitEvent()" *ngIf="showExitButton" class="image">
        <button (click)="removeUnusedParamaters()">remove Useless data</button>
    </div>
    <!-- make all errors and warnings pop-up when saving button is pressed -->
    <div>
        <mat-form-field>
            <mat-label>Editor Page</mat-label>
            <mat-select [(ngModel)]="currentEditorPage" (ngModelChange)="editorTabChange()">
                @for (page of editorValues['editorPage']; track page) {
                <mat-option [value]="page.value">{{page.viewValue}}</mat-option>
                }
            </mat-select>
        </mat-form-field>
    </div>
    <div id="slideEditor" *ngIf="currentEditorPage == 'slide'">
        <!-- name of slide in an input box, and a button to rename it. -->
        <!-- delete slide button -->
        <!-- select styling by slide -->
        <h1>current slide: '{{currentSlide}}'</h1>
        <h2 *ngIf="changesMade" class="warning">Current changes to this slide aren't saved!</h2>
        <button *ngIf="createNewSlideButton"
            (click)="createSlide(currentAutocompleteValue, {'setAutocomplete': true, 'removeCreateButton': true})">Create
            '{{currentAutocompleteValue}}'
            slide</button>
        <button (click)="deleteSlide(currentSlide)" *ngIf="!confirmDelete">Delete slide '{{currentSlide}}'</button>
        <button (click)="deleteSlide(currentSlide)" *ngIf="confirmDelete">Confirm to Delete slide
            '{{currentSlide}}'</button>
        <form>
            <mat-form-field>
                <mat-label>Slide selector</mat-label>
                <input type="text" placeholder="Pick one" aria-label="Slide" matInput [formControl]="searchControl"
                    placeholder="Select an slide" [matAutocomplete]="selectSlideAutocomplete">
                @if (currentAutocompleteValue) {
                <button matSuffix mat-icon-button aria-label="Clear" (click)="setValueOfAutocomplete('')">
                    <mat-icon>close</mat-icon>
                </button>
                }
                <mat-autocomplete #selectSlideAutocomplete="matAutocomplete">
                    <mat-option *ngFor="let option of filteredData" [value]="option.id + ': ' + option.type">
                        {{option.id}}: {{option.type}}
                    </mat-option>
                </mat-autocomplete>
            </mat-form-field>
        </form>
        <button (click)="saveEditing('slide')">Save Slide</button>
        <div *ngIf="slide['type'] != 'variable' && slide['type'] != 'playSound'">
            <mat-form-field>
                <mat-label>Scene</mat-label>
                <mat-select [(ngModel)]="slide['scene']" (ngModelChange)="slideSceneChange()">
                    @for (scene of editorValues['scenes']; track scene) {
                    <mat-option [value]="scene.value">{{scene.viewValue}}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
            <div *ngIf="slide['scene'] != '-1' && doesThisSceneExist(slide['scene'])">
                <hr>
                <p>scene preview:</p>
                <div [ngStyle]="scene.styling" class="previewScene">
                    <button (click)="tryToPlayAudio('scene')" *ngIf="scene['music'] != undefined">Test Audio</button>
                </div>
                <hr>
            </div>
            <p *ngIf="slide['scene'] == '-1'">With scene set to NONE, it'll use the scene it has loaded from a
                previous slide.</p>
            <p *ngIf="slide['scene'] != '-1' && !doesThisSceneExist(slide['scene'])" class="warning">The selected Scene
                does not exist. The app will take the default Scene instead.</p>
        </div>
        <div *ngIf="slide['type'] != 'variable' && slide['type'] != 'playSound'">
            <p>Textbox</p>
            <textarea name="" id="" cols="40" rows="1" [(ngModel)]="slide['text']"
                (ngModelChange)="setEditedValue(true)"></textarea>
        </div>
        <div>
            <mat-form-field>
                <mat-label>Slide Mode</mat-label>
                <mat-select [(ngModel)]="slide['type']" (ngModelChange)="slideTypeChange()">
                    @for (mode of editorValues['slideModes']; track mode) {
                    <mat-option [value]="mode.value">{{mode.viewValue}}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
        </div>
        <h2 *ngIf="slide['next'] == '-1' && slide['type'] != 'choice'" class="error">'-1' is not a valid slide</h2>
        <div *ngIf="slide['next'] != '-1' && !doesThisSlideExist(slide['next']) && slide['type'] != 'choice'">
            <h2 class="warning">This Slide '{{slide['next']}}' does not
                exist, add it.</h2>
            <button (click)="createSlide(slide['next'])">Create Slide '{{slide['next']}}'</button>
        </div>

        <div *ngIf="slide['type'] == 'choice'">
            <!-- choice -->
            <h2 *ngIf="slide['choices'] == undefined || slide['choices'].length == 0" class="error">This is a dead
                end, add some choices!</h2>
            <div *ngFor="let choice of slide['choices']; let i = index">
                <p>Text of option</p>
                <input type="text" [(ngModel)]="choice['text']" (ngModelChange)="setEditedValue(true)">
                <p>Goes to Slide</p>
                <input type="text" [(ngModel)]="choice['next']" (ngModelChange)="setEditedValue(true)">
                <h2 *ngIf="choice['next'] == '-1'" class="error">'-1' is not a valid slide</h2>
                <div *ngIf="choice['next'] != '-1' && !doesThisSlideExist(choice['next'])">
                    <h2 class="warning">This Slide
                        '{{choice['next']}}' does not exist, add it.</h2>
                    <button (click)="createSlide(choice['next'])">Create Slide '{{choice['next']}}'</button>
                </div>
                <button (click)="deleteOption(i)">delete</button>
                <!-- advanced -->
            </div>
            <button (click)="addOption()">add option</button>
        </div>
        <div *ngIf="slide['type'] == 'prompt'">
            <!-- prompt -->
            <p>Text</p>
            <input type="text" [(ngModel)]="slide['nextSlideText']" (ngModelChange)="setEditedValue(true)">
            <p>Next Slide</p>
            <input type="text" [(ngModel)]="slide['next']" (ngModelChange)="setEditedValue(true)">
        </div>
        <div *ngIf="slide['type'] == 'variable'">
            <!-- variable -->
            <p>Variable</p>
            <input type="text" [(ngModel)]="slide['variable']['name']" (ngModelChange)="setEditedValue(true)">
            <mat-form-field>
                <mat-label>Modifier</mat-label>
                <mat-select [(ngModel)]="slide['variable']['type']" (ngModelChange)="setEditedValue(true)">
                    @for (modifier of editorValues['variableModifier']; track modifier) {
                    <mat-option [value]="modifier.value">{{modifier.viewValue}}</mat-option>
                    }
                </mat-select>
            </mat-form-field>
            <p>Value</p>
            <input type="text" [(ngModel)]="slide['variable']['value']" (ngModelChange)="setEditedValue(true)">
            <p>Next Slide</p>
            <input type="text" [(ngModel)]="slide['next']" (ngModelChange)="setEditedValue(true)">
        </div>
        <div *ngIf="slide['type'] == 'playSound'">
            <!-- playSound -->
            <p>Sound</p>
            <input type="text" [(ngModel)]="slide['sound']" (ngModelChange)="setEditedValue(true)">
            <p>Volume</p>
            <input type="number" [(ngModel)]="slide['volume']" min="0.01" max="1" step="0.01"
                (ngModelChange)="setEditedValue(true)">
            <button (click)="tryToPlayAudio('slide')">Test Audio</button>
            <p>Next Slide</p>
            <input type="text" [(ngModel)]="slide['next']" (ngModelChange)="setEditedValue(true)">
        </div>
    </div>
    <div id="defaultDataEditor" *ngIf="currentEditorPage == 'default'">
        <h2 *ngIf="changesMade" class="warning">Current changes to these settings aren't saved!</h2>
        <!-- default choice styling -->
        <!-- default textbox styling -->
        <!-- default nextSlide styling -->
        <!-- default NextSlideText -->
        <!-- start slide -->
        <!-- show exit button -->
        <!-- show save button -->
    </div>
    <div id="sceneEditor" *ngIf="currentEditorPage == 'scene'">
        <h2 *ngIf="changesMade" class="warning">Current changes to this scene aren't saved!</h2>
        <!-- selector of which scene -->
        <!-- button to clear autcomplete input -->
        <!-- name of scene in an input box, and a button to rename it. -->
        <!-- delete scene button -->
        <!-- music -->
        <!-- volume + tester -->
        <!-- ngfor
                styling key input - value input - delete styling row button
        -->
        <!-- add styling row button -->
    </div>
    <div id="styleEditor" *ngIf="currentEditorPage == 'style'">
        <h2 *ngIf="changesMade" class="warning">Current changes to this styling aren't saved!</h2>
        <!-- selector of which style -->
        <!-- button to clear autcomplete input -->
        <!-- name of style in an input box, and a button to rename it. -->
        <!-- delete style button -->
        <!-- ngfor
                styling key input - value input - delete styling row button
        -->
        <!-- add styling row button -->
    </div>
</div>